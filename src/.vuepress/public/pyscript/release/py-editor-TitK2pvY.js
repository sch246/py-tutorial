import{T as e,d as t,X as r,H as n}from"./core-JtrGP9Xi.js";let o=0;const i=e=>`${e}-editor-${o++}`,s=new Map,a={worker:{onReady:({runAsync:e,io:t},{sync:r})=>{t.stdout=e=>r.write(e),t.stderr=e=>r.writeErr(e),r.revoke(),r.runAsync=e}}};function c(e){return e.replace(/Error: Traceback \(most recent call last\):[\s\S]*?File "<exec>"/,'Error: Traceback (most recent call last):\n  File "<exec>"')}async function l({currentTarget:e}){const{env:t,pySrc:o,outDiv:i}=this;if(e.disabled=!0,i.innerHTML="",!s.has(t)){const e=URL.createObjectURL(new Blob([""])),o=r.call(new n(null,a),e,{type:this.interpreter}),{sync:i}=o,{promise:c,resolve:l}=Promise.withResolvers();s.set(t,c),i.revoke=()=>{URL.revokeObjectURL(e),l(o)}}s.get(t).then((t=>{t.onerror=({error:e})=>{let t=`${e.message||e}`;i.innerHTML+=`<span style='color:red'>${c(t)}</span>\n`,console.error(e)};const r=()=>{e.disabled=!1},{sync:n}=t;n.write=e=>{i.innerText+=`${e}\n`},n.writeErr=e=>{i.innerHTML+=`<span style='color:red'>${c(e)}</span>\n`},n.runAsync(o).then(r,r)}))}const d=(e,t)=>{const r=document.createElement("div");r.className=`${t}-editor-input`,r.setAttribute("aria-label","Python Script Area");const n=((e,t)=>{const r=document.createElement("button");return r.className=`absolute ${t}-editor-run-button`,r.innerHTML='<svg style="height:20px;width:20px;vertical-align:-.125em;transform-origin:center;overflow:visible;color:green" viewBox="0 0 384 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(192 256)" transform-origin="96 0"><g transform="translate(0,0) scale(1,1)"><path d="M361 215C375.3 223.8 384 239.3 384 256C384 272.7 375.3 288.2 361 296.1L73.03 472.1C58.21 482 39.66 482.4 24.52 473.9C9.377 465.4 0 449.4 0 432V80C0 62.64 9.377 46.63 24.52 38.13C39.66 29.64 58.21 29.99 73.03 39.04L361 215z" fill="currentColor" transform="translate(-192 -256)"></path></g></g></svg>',r.setAttribute("aria-label","Python Script Run Button"),r.addEventListener("click",e),r})(e,t),o=document.createElement("div");return o.addEventListener("keydown",(e=>{e.stopPropagation()})),r.append(n,o),r},u=(e,t)=>{const r=document.createElement("div");r.className=`${t}-editor-box`;const n=d(e,t),o=(e=>{const t=document.createElement("div");return t.className=`${e}-editor-output`,t.id=`${i(e)}-output`,t})(t);return r.append(n,o),[r,o]},m=async(e,r,n)=>{const[{basicSetup:o,EditorView:s},{Compartment:a},{python:c},{indentUnit:d},{keymap:m},{defaultKeymap:p}]=await Promise.all([import("./codemirror-ywnYW0_0.js"),import("./codemirror_state-W084kUeH.js"),import("./codemirror_lang-python-8H4JLl61.js"),import("./codemirror_language-7C1keQUN.js").then((function(e){return e.x})),import("./codemirror_view-nQOl-mcb.js").then((function(e){return e.q})),import("./codemirror_commands-Yc6lYio6.js")]),y=e.getAttribute("target");let v;if(y){if(v=document.getElementById(y)||document.querySelector(y),!v)throw new Error(`Unknown target ${y}`)}else v=document.createElement(`${r}-editor`),v.style.display="block",e.after(v);v.id||(v.id=i(r)),v.hasAttribute("exec-id")||v.setAttribute("exec-id",0),v.hasAttribute("root")||v.setAttribute("root",v.id);const b=`${n}-${e.getAttribute("env")||i(r)}`,f={interpreter:n,env:b,get pySrc(){return k.state.doc.toString()},get outDiv(){return w}},g=l.bind(f),[h,w]=u(g,r);h.dataset.env=e.hasAttribute("env")?b:n;const E=h.querySelector(`.${r}-editor-input > div`).attachShadow({mode:"open"});E.innerHTML="<style> :host { all: initial; }</style>",v.appendChild(h);const $=t(e.textContent).trim(),x=/^(\s+)/m.test($)?RegExp.$1:"    ",k=new s({extensions:[d.of(x),(new a).of(c()),m.of([...p,{key:"Ctrl-Enter",run:g,preventDefault:!0},{key:"Cmd-Enter",run:g,preventDefault:!0},{key:"Shift-Enter",run:g,preventDefault:!0}]),o],parent:E,doc:$})};let p=0;const y=()=>{p=0,v()},v=async()=>{if(!p){p=setTimeout(y,250);for(const[t,r]of e){const e=`pre[type="${t}-editor"],script[type="${t}-editor"]`;for(const n of document.querySelectorAll(e))n.type+="-active",await m(n,t,r),n.parentNode&&n.parentNode.removeChild(n)}}};new MutationObserver(v).observe(document,{childList:!0,subtree:!0});var b=v();export{b as default};
//# sourceMappingURL=py-editor-TitK2pvY.js.map
